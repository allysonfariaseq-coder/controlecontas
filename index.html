<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Compras & Faturas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f5f5f5;
    }
    h1, h2 {
      text-align: center;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select, button {
      margin-top: 5px;
      padding: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      margin-top: 15px;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #007bff;
      color: white;
    }
    .card {
      background: #f0f8ff;
      padding: 15px;
      margin-top: 15px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Controle de Compras</h1>
    <label>Valor da compra:</label>
    <input type="number" id="valor" placeholder="Ex: 120.50">
    
    <label>Tipo de conta:</label>
    <select id="tipoConta" onchange="toggleCartao()">
      <option value="">Selecione</option>
      <option value="cartao">Cartão de crédito</option>
      <option value="fora">Fora do cartão</option>
    </select>

    <div id="campoCartao" style="display:none;">
      <label>Cartão:</label>
      <select id="cartao">
        <option value="">Selecione o cartão</option>
        <option value="Nubank">Nubank</option>
        <option value="Inter">Inter</option>
        <option value="Itaú">Itaú</option>
      </select>
    </div>
    
    <label>Parcelas:</label>
    <input type="number" id="parcelas" value="1" min="1">
    
    <label>Data da compra:</label>
    <input type="date" id="data">
    
    <label>Descrição:</label>
    <input type="text" id="descricao" placeholder="Ex: Supermercado">

    <button onclick="adicionarCompra()">Adicionar Compra</button>

    <div class="card">
      <h2>Resumo por Cartão</h2>
      <div id="resumo"></div>
    </div>

    <div class="card">
      <h2>Detalhamento do Mês</h2>
      <div id="detalhamento"></div>
    </div>

    <div class="card">
      <h2>Faturas Futuras</h2>
      <div id="futuras"></div>
    </div>
  </div>

<script>
  let compras = JSON.parse(localStorage.getItem("compras")) || [];

  function salvar() {
    localStorage.setItem("compras", JSON.stringify(compras));
  }

  function getDataHoje() {
    const hoje = new Date();
    const ano = hoje.getFullYear();
    const mes = String(hoje.getMonth() + 1).padStart(2, '0');
    const dia = String(hoje.getDate()).padStart(2, '0');
    return `${ano}-${mes}-${dia}`;
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("data").value = getDataHoje();
    atualizar();
  });

  function toggleCartao() {
    const tipo = document.getElementById("tipoConta").value;
    document.getElementById("campoCartao").style.display = (tipo === "cartao") ? "block" : "none";
  }

  function adicionarCompra() {
    const valor = parseFloat(document.getElementById("valor").value);
    const tipoConta = document.getElementById("tipoConta").value;
    const cartao = document.getElementById("cartao").value;
    const parcelas = parseInt(document.getElementById("parcelas").value);
    const data = document.getElementById("data").value;
    const descricao = document.getElementById("descricao").value;

    if (!valor || !tipoConta || !data) {
      alert("Preencha todos os campos obrigatórios!");
      return;
    }
    if (tipoConta === "cartao" && !cartao) {
      alert("Selecione o cartão!");
      return;
    }

    compras.push({ valor, tipoConta, cartao, parcelas, data, descricao });
    salvar();
    atualizar();

    document.getElementById("valor").value = "";
    document.getElementById("tipoConta").value = "";
    document.getElementById("cartao").value = "";
    document.getElementById("parcelas").value = 1;
    document.getElementById("descricao").value = "";
    document.getElementById("data").value = getDataHoje();
    toggleCartao();
  }

  function atualizar() {
    resumoPorCartao();
    detalharMes();
    faturasFuturas();
  }

  function resumoPorCartao() {
    const resumo = {};
    compras.forEach(c => {
      if (c.tipoConta === "cartao") {
        resumo[c.cartao] = (resumo[c.cartao] || 0) + c.valor;
      }
    });
    let html = "";
    for (let cartao in resumo) {
      html += `<p><strong>${cartao}:</strong> R$ ${resumo[cartao].toFixed(2)}</p>`;
    }
    document.getElementById("resumo").innerHTML = html || "<p>Nenhum gasto com cartão.</p>";
  }

  function detalharMes() {
    const hoje = new Date();
    const mesAtual = hoje.getMonth() + 1;
    const anoAtual = hoje.getFullYear();
    let html = "<table><tr><th>Data</th><th>Descrição</th><th>Valor</th><th>Cartão</th><th>Parcelas</th></tr>";
    let temDados = false;

    compras.forEach(c => {
      const [ano, mes] = c.data.split("-").map(Number);
      if (ano === anoAtual && mes === mesAtual) {
        html += `<tr>
          <td>${c.data}</td>
          <td>${c.descricao}</td>
          <td>R$ ${c.valor.toFixed(2)}</td>
          <td>${c.tipoConta === "cartao" ? c.cartao : "-"}</td>
          <td>${c.parcelas}x</td>
        </tr>`;
        temDados = true;
      }
    });
    html += "</table>";
    document.getElementById("detalhamento").innerHTML = temDados ? html : "<p>Nenhuma compra no mês atual.</p>";
  }

  function faturasFuturas() {
    const hoje = new Date();
    const futuras = {};

    compras.forEach(c => {
      if (c.tipoConta === "cartao" && c.parcelas > 1) {
        let dataCompra = new Date(c.data);
        for (let i = 0; i < c.parcelas; i++) {
          let vencimento = new Date(dataCompra);
          vencimento.setMonth(vencimento.getMonth() + i);
          const chave = `${vencimento.getFullYear()}-${String(vencimento.getMonth() + 1).padStart(2, '0')}`;
          futuras[chave] = futuras[chave] || [];
          futuras[chave].push({
            descricao: c.descricao,
            valor: c.valor / c.parcelas,
            cartao: c.cartao,
            parcela: `${i+1}/${c.parcelas}`
          });
        }
      }
    });

    let html = "";
    for (let mes in futuras) {
      html += `<h3>${mes}</h3><table>
        <tr><th>Descrição</th><th>Parcela</th><th>Valor</th><th>Cartão</th></tr>`;
      futuras[mes].forEach(f => {
        html += `<tr>
          <td>${f.descricao}</td>
          <td>${f.parcela}</td>
          <td>R$ ${f.valor.toFixed(2)}</td>
          <td>${f.cartao}</td>
        </tr>`;
      });
      html += "</table>";
    }
    document.getElementById("futuras").innerHTML = html || "<p>Nenhuma fatura futura.</p>";
  }
</script>
</body>
</html>
